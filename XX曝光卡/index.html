<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XX曝光台</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1E40AF',
                        secondary: '#3B82F6',
                        accent: '#60A5FA',
                        neutral: '#F1F5F9',
                        'neutral-dark': '#334155',
                        success: '#10B981',
                        danger: '#EF4444',
                        warning: '#F59E0B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .photo-container {
                aspect-ratio: 4/6;
            }
            .card-shadow {
                box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            }
            .upload-overlay {
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            .photo-wrapper:hover .upload-overlay {
                opacity: 1;
            }
            .signature-pad {
                touch-action: none;
            }
            .grid-container {
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 1.5rem;
            }
            .btn-hover-effect {
                transition: transform 0.2s, box-shadow 0.2s;
            }
            .btn-hover-effect:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            }
            .scale-on-hover {
                transition: transform 0.3s ease;
            }
            .scale-on-hover:hover {
                transform: scale(1.02);
            }
            .editable-title {
                border-bottom: 2px solid transparent;
                transition: border-color 0.3s ease;
            }
            .editable-title:focus {
                outline: none;
                border-bottom-color: #3B82F6;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <!-- 顶部区域 - 不包含按钮 -->
    <div id="screenshotArea" class="bg-white rounded-2xl overflow-hidden card-shadow mx-4 my-8 scale-on-hover">
        <!-- 顶部标题栏 -->
        <div class="bg-gradient-to-r from-primary to-secondary text-white p-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
                <!-- 左上角标题区域 -->
                <div class="flex flex-col mb-4 md:mb-0">
                    <div class="flex items-center">
                        <i class="fa fa-eye text-2xl mr-3"></i>
                        <h1 id="editableTitle" class="text-xl md:text-2xl font-bold tracking-tight editable-title" contenteditable="true">XX曝光台</h1>
                    </div>
                    <div class="ml-7 mt-1 text-blue-100 text-sm">
                        <span id="subtitle" class="editable-title" contenteditable="true">真相在此，一目了然</span>
                    </div>
                </div>
                
                <!-- 右上角证件照区域 -->
                <div class="relative">
                    <div class="w-24 h-32 bg-white/20 rounded-lg overflow-hidden border-2 border-white/30 flex items-center justify-center">
                        <img id="idPhoto" src="https://picsum.photos/seed/idphoto/300/400" alt="证件照" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="idPhotoInput" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-2 py-1 rounded-lg transition-all duration-300 flex items-center text-xs">
                                <i class="fa fa-camera mr-1"></i>更换照片
                            </label>
                            <input type="file" id="idPhotoInput" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'idPhoto')">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 页面标题和说明 -->
        <div class="p-6 border-b border-gray-100">
            <h2 class="text-2xl font-bold text-neutral-dark mb-2">曝光内容管理</h2>
            <p class="text-gray-600 max-w-2xl">上传并管理曝光图片，添加签名后可导出为PDF或图片格式</p>
        </div>
        
        <!-- 曝光卡片区域 -->
        <div class="p-6">
            <h3 class="text-xl font-semibold text-neutral-dark mb-5 flex items-center">
                <i class="fa fa-picture-o text-primary mr-2"></i>图片区域
                <span class="ml-2 text-sm font-normal text-gray-500">(点击图片可上传替换)</span>
            </h3>
            <div class="grid-container">
                <!-- 九宫格图片区域 -->
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image1" src="https://picsum.photos/seed/photo1/400/600" alt="图片1" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input1" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input1" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image1')">
                        </div>
                    </div>
                </div>
                
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image2" src="https://picsum.photos/seed/photo2/400/600" alt="图片2" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input2" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input2" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image2')">
                        </div>
                    </div>
                </div>
                
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image3" src="https://picsum.photos/seed/photo3/400/600" alt="图片3" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input3" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input3" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image3')">
                        </div>
                    </div>
                </div>
                
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image4" src="https://picsum.photos/seed/photo4/400/600" alt="图片4" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input4" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input4" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image4')">
                        </div>
                    </div>
                </div>
                
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image5" src="https://picsum.photos/seed/photo5/400/600" alt="图片5" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input5" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input5" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image5')">
                        </div>
                    </div>
                </div>
                
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image6" src="https://picsum.photos/seed/photo6/400/600" alt="图片6" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input6" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input6" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image6')">
                        </div>
                    </div>
                </div>
                
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image7" src="https://picsum.photos/seed/photo7/400/600" alt="图片7" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input7" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input7" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image7')">
                        </div>
                    </div>
                </div>
                
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image8" src="https://picsum.photos/seed/photo8/400/600" alt="图片8" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input8" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input8" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image8')">
                        </div>
                    </div>
                </div>
                
                <div class="photo-wrapper relative">
                    <div class="photo-container bg-neutral rounded-xl overflow-hidden flex items-center justify-center border-2 border-dashed border-gray-300 hover:border-primary transition-all duration-300">
                        <img id="image9" src="https://picsum.photos/seed/photo9/400/600" alt="图片9" class="w-full h-full object-cover">
                        <div class="upload-overlay absolute inset-0 bg-black/50 flex items-center justify-center">
                            <label for="input9" class="cursor-pointer text-white bg-primary/80 hover:bg-primary px-4 py-2 rounded-lg transition-all duration-300 flex items-center">
                                <i class="fa fa-upload mr-2"></i>更换图片
                            </label>
                            <input type="file" id="input9" accept="image/*" class="hidden" onchange="handleImageUpload(this, 'image9')">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 签名区域 -->
        <div class="p-6 border-t border-gray-100">
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-4">
                <h3 class="text-xl font-semibold text-neutral-dark flex items-center">
                    <i class="fa fa-signature text-primary mr-2"></i>签名区
                    <span class="ml-2 text-sm font-normal text-gray-500">(使用鼠标或触摸屏幕签名)</span>
                </h3>
                <div class="flex space-x-3 mt-3 md:mt-0">
                    <button id="clearSignature" class="bg-white border border-danger text-danger hover:bg-danger hover:text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center btn-hover-effect">
                        <i class="fa fa-eraser mr-2"></i>清除
                    </button>
                    <button id="saveSignature" class="bg-white border border-success text-success hover:bg-success hover:text-white px-4 py-2 rounded-lg transition-all duration-300 flex items-center btn-hover-effect">
                        <i class="fa fa-check mr-2"></i>保存
                    </button>
                </div>
            </div>
            <div class="border-2 border-gray-200 rounded-xl p-2 bg-gray-50 shadow-inner">
                <canvas id="signatureCanvas" class="w-full h-52 bg-white rounded-lg signature-pad" touch-action="none"></canvas>
                <div class="flex justify-between items-center mt-2 px-2">
                    <p class="text-sm text-gray-500">在此区域手写签名</p>
                    <div class="flex space-x-2">
                        <button id="undoSignature" class="text-gray-500 hover:text-primary transition-colors">
                            <i class="fa fa-undo"></i> 撤销
                        </button>
                        <button id="redoSignature" class="text-gray-500 hover:text-primary transition-colors">
                            <i class="fa fa-repeat"></i> 重做
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 功能按钮 - 位于截图区域外 -->
    <div class="container mx-auto px-4 py-4 flex flex-wrap justify-center gap-3">
        <button id="saveAsPDF" class="bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center btn-hover-effect">
            <i class="fa fa-file-pdf-o mr-2"></i>保存为PDF
        </button>
        <button id="saveAsImage" class="bg-secondary hover:bg-secondary/90 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center btn-hover-effect">
            <i class="fa fa-file-image-o mr-2"></i>保存为图片
        </button>
        <button id="resetAll" class="bg-danger hover:bg-danger/90 text-white px-6 py-3 rounded-lg transition-all duration-300 flex items-center btn-hover-effect">
            <i class="fa fa-refresh mr-2"></i>重置
        </button>
    </div>

    <script>
        // 图片上传处理
        function handleImageUpload(input, targetId) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById(targetId).src = e.target.result;
                }
                reader.readAsDataURL(input.files[0]);
            }
        }

        // 签名功能实现
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('signatureCanvas');
            const ctx = canvas.getContext('2d');
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let paths = [];
            let currentPath = [];
            let undoStack = [];
            
            // 设置Canvas尺寸
            function resizeCanvas() {
                const { width, height } = canvas.getBoundingClientRect();
                // 考虑设备像素比以获得清晰的线条
                const dpr = window.devicePixelRatio || 1;
                canvas.width = width * dpr;
                canvas.height = height * dpr;
                ctx.scale(dpr, dpr);
                redrawCanvas();
            }
            
            // 重绘Canvas
            function redrawCanvas() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                paths.forEach(path => {
                    ctx.beginPath();
                    ctx.moveTo(path[0][0], path[0][1]);
                    for (let i = 1; i < path.length; i++) {
                        ctx.lineTo(path[i][0], path[i][1]);
                    }
                    ctx.stroke();
                });
            }
            
            // 初始化Canvas
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            // 设置绘图样式
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
            ctx.strokeStyle = '#334155';
            
            // 鼠标/触摸事件处理
            function startDrawing(e) {
                isDrawing = true;
                const rect = canvas.getBoundingClientRect();
                if (e.type === 'mousedown') {
                    [lastX, lastY] = [e.clientX - rect.left, e.clientY - rect.top];
                } else {
                    [lastX, lastY] = [e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top];
                }
                currentPath = [[lastX, lastY]];
                paths.push(currentPath);
                undoStack = []; // 开始新的绘制，清空撤销栈
            }
            
            function draw(e) {
                if (!isDrawing) return;
                const rect = canvas.getBoundingClientRect();
                let x, y;
                
                if (e.type === 'mousemove') {
                    x = e.clientX - rect.left;
                    y = e.clientY - rect.top;
                } else {
                    e.preventDefault(); // 防止触摸滚动
                    x = e.touches[0].clientX - rect.left;
                    y = e.touches[0].clientY - rect.top;
                }
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                [lastX, lastY] = [x, y];
                currentPath.push([x, y]);
            }
            
            function stopDrawing() {
                isDrawing = false;
            }
            
            // 绑定鼠标事件
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // 绑定触摸事件
            canvas.addEventListener('touchstart', startDrawing);
            canvas.addEventListener('touchmove', draw);
            canvas.addEventListener('touchend', stopDrawing);
            canvas.addEventListener('touchcancel', stopDrawing);
            
            // 清除签名
            document.getElementById('clearSignature').addEventListener('click', function() {
                paths = [];
                redrawCanvas();
            });
            
            // 保存签名
            document.getElementById('saveSignature').addEventListener('click', function() {
                const dataURL = canvas.toDataURL();
                // 这里可以将dataURL保存到服务器或本地
                alert('签名已保存!');
            });
            
            // 撤销
            document.getElementById('undoSignature').addEventListener('click', function() {
                if (paths.length > 0) {
                    undoStack.push(paths.pop());
                    redrawCanvas();
                }
            });
            
            // 重做
            document.getElementById('redoSignature').addEventListener('click', function() {
                if (undoStack.length > 0) {
                    paths.push(undoStack.pop());
                    redrawCanvas();
                }
            });

            // 保存为PDF
            function saveAsPDF() {
                // 创建加载动画
                const loadingOverlay = document.createElement('div');
                loadingOverlay.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                loadingOverlay.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-lg flex items-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mr-4"></div>
                        <p class="text-lg font-medium text-gray-800">正在生成PDF，请稍候...</p>
                    </div>
                `;
                document.body.appendChild(loadingOverlay);
                
                html2canvas(document.getElementById('screenshotArea'), {
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    const imgData = canvas.toDataURL('image/jpeg', 1.0);
                    const pdf = new jspdf.jsPDF({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: 'a4'
                    });
                    
                    const imgWidth = 210;
                    const imgHeight = canvas.height * imgWidth / canvas.width;
                    
                    pdf.addImage(imgData, 'JPEG', 0, 0, imgWidth, imgHeight);
                    pdf.save('XX曝光台.pdf');
                    
                    // 移除加载动画
                    document.body.removeChild(loadingOverlay);
                });
            }

            // 保存为图片
            function saveAsImage() {
                // 创建加载动画
                const loadingOverlay = document.createElement('div');
                loadingOverlay.className = 'fixed inset-0 bg-black/50 flex items-center justify-center z-50';
                loadingOverlay.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-lg flex items-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mr-4"></div>
                        <p class="text-lg font-medium text-gray-800">正在生成图片，请稍候...</p>
                    </div>
                `;
                document.body.appendChild(loadingOverlay);
                
                html2canvas(document.getElementById('screenshotArea'), {
                    scale: 2,
                    useCORS: true,
                    logging: false
                }).then(canvas => {
                    const link = document.createElement('a');
                    link.download = 'XX曝光台.png';
                    link.href = canvas.toDataURL('image/png');
                    link.click();
                    
                    // 移除加载动画
                    document.body.removeChild(loadingOverlay);
                });
            }

            // 重置所有图片
            function resetAllImages() {
                if (confirm('确定要重置所有内容吗？此操作不可恢复。')) {
                    for (let i = 1; i <= 9; i++) {
                        document.getElementById(`image${i}`).src = `https://picsum.photos/seed/photo${i}/400/600`;
                        document.getElementById(`input${i}`).value = '';
                    }
                    
                    // 重置证件照
                    document.getElementById('idPhoto').src = 'https://picsum.photos/seed/idphoto/300/400';
                    document.getElementById('idPhotoInput').value = '';
                    
                    // 重置标题
                    document.getElementById('editableTitle').textContent = 'XX曝光台';
                    document.getElementById('subtitle').textContent = '真相在此，一目了然';
                    
                    // 清除签名
                    paths = [];
                    redrawCanvas();
                    
                    alert('所有内容已重置为默认状态!');
                }
            }

            // 绑定导出按钮事件
            document.getElementById('saveAsPDF').addEventListener('click', saveAsPDF);
            document.getElementById('saveAsImage').addEventListener('click', saveAsImage);
            document.getElementById('resetAll').addEventListener('click', resetAllImages);
            
            // 标题编辑功能
            const editableTitle = document.getElementById('editableTitle');
            editableTitle.addEventListener('input', function() {
                // 保持页脚标题同步
                document.getElementById('footerTitle').textContent = this.textContent;
            });
            
            const subtitle = document.getElementById('subtitle');
            subtitle.addEventListener('input', function() {
                // 保持页脚副标题同步
                document.getElementById('footerSubtitle').textContent = this.textContent;
            });
        });
    </script>
</body>
</html>
    
